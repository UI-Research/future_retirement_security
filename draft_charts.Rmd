---
output:
  html_document:
    number_sections: FALSE
    self_contained: TRUE
    code_folding: hide
    toc: TRUE
    toc_float: TRUE
    css: www/web_report.css
    editor_options:
      chunk_output_type: console
self_contained: no      
editor_options:
  chunk_output_type: console
---

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato" />

![](www/images/urban-institute-logo.png)

```{r rmarkdown-setup, echo = FALSE}
knitr::opts_chunk$set(warning = FALSE)
knitr::opts_chunk$set(message = FALSE)

knitr::opts_chunk$set(fig.width = 6.5, fig.height = 5, fig.path = "figures/", dev = c("png", "cairo_pdf"))
```

```{r setup}
options(scipen = 999)

library(tidyverse)
library(urbnthemes)
library(grid)
library(gridExtra)
library(extrafont)

source("urban_style.R")

set_urbn_defaults(style = "print")
```

### N Charts About Future Retirement Security plots
### Aaron R. Williams
### `r format(Sys.time(), "%B %d, %Y %H:%M %p")`

## Chart 1: The share of retirees who will likely experience a decline in living standards will grow over time {.tabset}

* Numerator: age 70, price-adjusted, per-capita annuitized income
* Denominator: mean price-adjusted, per-capita earnings from ages 50 to 59

```{r}
cohorts <- c("1936-1945", "1946-1955", "1956-1965", "1966-1975", "1976-1985")

#' rename_cohort
#'
#' @param x a vector with cohorts
#'
#' @return a vector of renamed cohorts
rename_cohort <- function(x, two_lines = TRUE) {
  if (two_lines == TRUE) {
    cohort <- recode(x,
      `1936-1945` = "Pre-boomers\n(1936–1945)", 
      `1946-1955` = "Early boomers\n(1946–1955)", 
      `1956-1965` = "Late boomers\n(1956–1965)", 
      `1966-1975` = "Gen Xers\n(1966–1975)", 
      `1976-1985` = "Early millennials\n(1976-1985)")  
    
    factor(cohort, levels = c("Pre-boomers\n(1936–1945)", 
                              "Early boomers\n(1946–1955)", 
                              "Late boomers\n(1956–1965)", 
                              "Gen Xers\n(1966–1975)", 
                              "Early millennials\n(1976-1985)"))
  } else {
    cohort <- recode(x,
      `1936-1945` = "Pre-boomers (1936–1945)", 
      `1946-1955` = "Early boomers (1946–1955)", 
      `1956-1965` = "Late boomers (1956–1965)", 
      `1966-1975` = "Gen Xers (1966–1975)", 
      `1976-1985` = "Early millennials (1976-1985)") 
      
    factor(cohort, levels = c("Pre-boomers (1936–1945)", 
                              "Early boomers (1946–1955)", 
                              "Late boomers (1956–1965)", 
                              "Gen Xers (1966–1975)", 
                              "Early millennials (1976-1985)"))
  }
}

#' to_ordinal
#'
#' @param x translate numeric integers into ordinal numbers in a character vector 
#'
#' @return
#' @export
#'
#' @examples to_ordinal(1:30)
to_ordinal <- function(x, capitalize = FALSE, as_factor = FALSE) {
  # case_when(x %in% 11:13 ~ paste0(x, "th"),
  #           x %% 10 == 0 ~ paste0(x, "th"),
  #           x %% 10 == 1 ~ paste0(x, "st"),
  #           x %% 10 == 2 ~ paste0(x, "nd"),
  #           x %% 10 == 3 ~ paste0(x, "rd"),
  #           x %% 10 %in% 4:9 ~ paste0(x, "th"),
  #           TRUE ~ "ERROR")

  word <- case_when(x == 0 ~ "Zeroth",
                    x == 1 ~ "Bottom",
                    x == 2 ~ "Second",
                    x == 3 ~ "Third",
                    x == 4 ~ "Fourth",
                    x == 5 ~ "Top")  
  
  if (capitalize == TRUE) {
    tools::toTitleCase(word)
  } else {
    word
  }
}
```

### 75% replacement rate

```{r chart1}
chart1 <- read_csv("data/figure1.csv") %>%
  filter(ncharts_reprate %in% c("0-50%", "50-75%")) %>%
  filter(doby %in% cohorts) %>%
  mutate(doby = rename_cohort(doby)) %>%
  group_by(doby) %>%
  summarize(rep_rate_threshold = sum(count_PctSum_10_count)) %>%
  ggplot(aes(doby, rep_rate_threshold)) +
  geom_col() +
  geom_text(mapping = aes(label = scales::percent_format(accuracy = 1)(rep_rate_threshold / 100)), vjust = -1) +    
  scale_y_continuous(expand = expand_scale(mult = c(0, 0.1)),
                     limits = c(0, 50)) +
  labs(x = "Birth Cohort",
       y = NULL) +
  remove_ticks() +
  remove_axis()   

# create the output plot
plotr(titler("More than One-Third of Early Millennials Will Likely See Their Living Standards Fall\nwhen They Retire"),
      subtitler("Percentage of adults unable to replace 75% of their preretirement earnings at age 70"),
      chart1,
      caption,
      sourcer("DYNASIM4, ID963"),
      heights = c(2.6, 2, 30, 1, 1))
```

<!-- ### 80% replacement rate -->

<!-- ```{r chart1b} -->
<!-- chart1 <- read_csv("data/figure1.csv") %>% -->
<!--   filter(ncharts_reprate %in% c("0-50%", "50-75%", "75-80%")) %>% -->
<!--   filter(doby %in% cohorts) %>% -->
<!--   mutate(doby = rename_cohort(doby)) %>%   -->
<!--   group_by(doby) %>% -->
<!--   summarize(rep_rate_threshold = sum(count_PctSum_10_count)) %>% -->
<!--   ggplot(aes(doby, rep_rate_threshold)) + -->
<!--   geom_col() + -->
<!--   geom_text(mapping = aes(label = scales::percent(rep_rate_threshold / 100)), vjust = -1) +     -->
<!--   scale_y_continuous(expand = expand_scale(mult = c(0, 0.1)), -->
<!--                      limits = c(0, 50)) + -->
<!--   labs(x = "Birth Cohort", -->
<!--        y = NULL) + -->
<!--   remove_ticks() + -->
<!--   remove_axis()    -->

<!-- # create the output plot -->
<!-- plotr(titler("Age 70 Percentage of People Who Fail to Replace 80% of Age 50-59 Earnings"), -->
<!--       chart1, -->
<!--       caption, -->
<!--       sourcer("DYNASIM4, ID963"), -->
<!--       heights = c(2, 30, 1, 1)) -->
<!-- ``` -->

<!-- ### 85% replacement rate -->

<!-- ```{r chart1c} -->
<!-- chart1 <- read_csv("data/figure1.csv") %>% -->
<!--   filter(ncharts_reprate %in% c("0-50%", "50-75%", "75-80%", "80-85%")) %>% -->
<!--   filter(doby %in% cohorts) %>% -->
<!--   mutate(doby = rename_cohort(doby)) %>%   -->
<!--   group_by(doby) %>% -->
<!--   summarize(rep_rate_threshold = sum(count_PctSum_10_count)) %>% -->
<!--   ggplot(aes(doby, rep_rate_threshold)) + -->
<!--   geom_col() + -->
<!--   geom_text(mapping = aes(label = scales::percent(rep_rate_threshold / 100)), vjust = -1) +     -->
<!--   scale_y_continuous(expand = expand_scale(mult = c(0, 0.1)), -->
<!--                      limits = c(0, 50)) + -->
<!--   labs(x = "Birth Cohort", -->
<!--        y = NULL) + -->
<!--   remove_ticks() + -->
<!--   remove_axis()    -->

<!-- # create the output plot -->
<!-- plotr(titler("Age 70 Percentage of People Who Fail to Replace 85% of Age 50-59 Earnings"), -->
<!--       chart1, -->
<!--       caption, -->
<!--       sourcer("DYNASIM4, ID963"), -->
<!--       heights = c(2, 30, 1, 1)) -->
<!-- ``` -->

<!-- ### 90% replacement rate -->

<!-- ```{r chart1d} -->
<!-- chart1 <- read_csv("data/figure1.csv") %>% -->
<!--   filter(ncharts_reprate %in% c("0-50%", "50-75%", "75-80%", "80-85%", "85-90%")) %>% -->
<!--   filter(doby %in% cohorts) %>% -->
<!--   mutate(doby = rename_cohort(doby)) %>% -->
<!--   group_by(doby) %>% -->
<!--   summarize(rep_rate_threshold = sum(count_PctSum_10_count)) %>% -->
<!--   ggplot(aes(doby, rep_rate_threshold)) + -->
<!--   geom_col() + -->
<!--   geom_text(mapping = aes(label = scales::percent(rep_rate_threshold / 100)), vjust = -1) +     -->
<!--   scale_y_continuous(expand = expand_scale(mult = c(0, 0.1)), -->
<!--                      limits = c(0, 50)) + -->
<!--   labs(x = "Birth Cohort", -->
<!--        y = NULL) + -->
<!--   remove_ticks() + -->
<!--   remove_axis()    -->

<!-- # create the output plot -->
<!-- plotr(titler("Age 70 Percentage of People Who Fail to Replace 90% of Age 50-59 Earnings"), -->
<!--       chart1, -->
<!--       caption, -->
<!--       sourcer("DYNASIM4, ID963"), -->
<!--       heights = c(1.8, 30, 1, 1)) -->
<!-- ``` -->

<!-- ### 100% replacement rate -->

<!-- ```{r chart1e} -->
<!-- chart1 <- read_csv("data/figure1.csv") %>% -->
<!--   filter(ncharts_reprate %in% c("0-50%", "50-75%", "75-80%", "80-85%", "85-90%", "90-95%", "95-100%")) %>% -->
<!--   filter(doby %in% cohorts) %>% -->
<!--   mutate(doby = rename_cohort(doby)) %>% -->
<!--   group_by(doby) %>% -->
<!--   summarize(rep_rate_threshold = sum(count_PctSum_10_count)) %>% -->
<!--   ggplot(aes(doby, rep_rate_threshold)) + -->
<!--   geom_col() + -->
<!--   geom_text(mapping = aes(label = scales::percent(rep_rate_threshold / 100)), vjust = -1) +     -->
<!--   scale_y_continuous(expand = expand_scale(mult = c(0, 0.1)), -->
<!--                      limits = c(0, 50)) + -->
<!--   labs(x = "Birth Cohort", -->
<!--        y = NULL) + -->
<!--   remove_ticks() + -->
<!--   remove_axis()    -->

<!-- # create the output plot -->
<!-- plotr(titler("Age 70 Percentage of People Who Fail to Replace 100% of Age 50-59 Earnings"), -->
<!--       chart1, -->
<!--       caption, -->
<!--       sourcer("DYNASIM4, ID963"), -->
<!--       heights = c(1.8, 30, 1, 1)) -->
<!-- ``` -->

## Chart 2: Retirement Incomes are Increasing

```{r chart2}
chart2 <- read_csv("data/figure2.csv") %>%
  filter(doby %in% cohorts) %>%
  mutate(doby = rename_cohort(doby)) %>%  
  ggplot(aes(doby, ncharts_aftertax_income_P50)) +
  geom_col() +
  geom_text(mapping = aes(label = scales::dollar(signif(ncharts_aftertax_income_P50, 3), largest_with_cents = 0)), 
            vjust = -1) +    
  scale_y_continuous(expand = expand_scale(mult = c(0, 0.1))) +
  labs(x = "Birth Cohort",
       y = NULL) +
  remove_ticks() +
  remove_axis()

# create the output plot
plotr(titler("A Typical Early Millennial Retiree Will Receive about 30 Percent More Income Than a\nTypical Retiree Born 40 Years Earlier"),
      subtitler("Median annual Social Security income at age 70 (constant 2018 dollars)"),
      chart2,
      caption,
      sourcer("DYNASIM4, ID963"),
      heights = c(2.8, 1, 30, 1, 1))
```

## Chart 3: The Gender Gap in Social Secuirty Benefits is Narrowing

```{r, chart3}
chart3b <- read_csv("data/figure3b.csv") %>%
  mutate(male = recode(male, 
                       `1.Male` = "Male",
                       `2.Female` = "Female")) %>%  
  filter(doby %in% cohorts) %>%
  mutate(doby = rename_cohort(doby)) %>%  
  ggplot(aes(doby, Ownssb_P50, fill = male)) +
  geom_col(position = "dodge") +
  geom_text(mapping = aes(label = scales::dollar(round(Ownssb_P50, -2), largest_with_cents = 0)), 
            position = position_dodge(width = 0.75), vjust = -1) +    
  scale_y_continuous(expand = expand_scale(mult = c(0, 0.15))) +
  labs(x = "Birth Cohort",
       y = NULL) +
  remove_ticks() +
  remove_axis() 

# create the output plot
plotr(titler("For Early Millennials, Women’s Median Age-70 Social Security Benefits Will Rise to\n85 Percent of the Median for Men"),
      subtitler("Median annual Social Security income at age 70 (constant 2018 dollars)"),
      chart3b,
      caption,
      sourcer("DYNASIM4, ID963"),
      heights = c(2.6, 2, 30, 1, 1))
```

## Chart 4: Women's Lifetime Earnings are Increasing

```{r chart4}
chart4 <- read_csv("data/figure4.csv") %>%
  mutate(male = recode(male, 
                       `1.Male` = "Male",
                       `2.Female` = "Female")) %>%
  filter(doby %in% cohorts) %>%
  filter(!is.na(male)) %>%
  mutate(doby = rename_cohort(doby)) %>%  
  ggplot(aes(doby, lifetime_earn_P50, fill = male)) +
  geom_col(position = "dodge") +
  geom_text(mapping = aes(label = scales::dollar(round(lifetime_earn_P50, -2), largest_with_cents = 0)), 
            position = position_dodge(width = 1), vjust = -1) +    
  scale_y_continuous(expand = expand_scale(mult = c(0, 0.15))) +
  labs(x = "Birth Cohort",
       y = NULL) +
  remove_ticks() +
  remove_axis() 

# create the output plot
plotr(titler("Over Her Lifetime, a Typical Early Millennial Woman Will Earn More than Twice as Much\nas Her Pre-Boomer Counterpart"),
      subtitler("Median earnings from ages 25 to 69 (constant 2018 dollars)"),
      chart4,
      caption,
      sourcer("DYNASIM4, ID963"),
      heights = c(2.6, 2, 30, 1, 1))
```

## Chart 5: More Women Are Earnings Worker's Social Security Benefits

```{r chart5}
benefits <- c("Worker only", "Worker supplemented by\nspousal or survivor", "Spouse or survivor only")

chart5 <- read_csv("data/figure5.csv") %>%
  filter(doby %in% cohorts) %>%
  select(doby,
         `Worker supplemented by spousal or survivor` = dualben_Mean,
         `Worker only` = wrkonly_Mean,
         `Spouse or survivor only` = auxonly_Mean) %>%
  gather(key = "benefit_type", value = "share", -doby) %>%
  mutate(benefit_type = recode(benefit_type, 
                               `Worker supplemented by spousal or survivor` = "Worker supplemented by\nspousal or survivor")) %>%  
  mutate(benefit_type = factor(benefit_type, levels = benefits)) %>%
  mutate(doby = rename_cohort(doby)) %>%
  ggplot(aes(doby, share, fill = benefit_type)) +
  geom_col(position = "dodge") +
  scale_y_continuous(expand = expand_scale(mult = c(0, 0.1)), labels = scales::percent_format(accuracy = 1)) +
  labs(x = NULL,
       y = NULL) +
  remove_ticks()

# create the output plot
plotr(titler("Women’s Social Security Benefit Types are Changing"),
      subtitler("Social Security benefit type at age 70 for female beneficiaries (%)"),
      chart5,
      caption,
      sourcer("DYNASIM4, ID963"),
      heights = c(1.8, 2, 30, 1, 1))
```

## Chart 6: Racial and ethnic disparities in retirement income will persist 

```{r chart6}
chart6 <- read_csv("data/figure6.csv") %>%
  filter(doby %in% cohorts) %>%
  filter(!is.na(raceeth)) %>%
  filter(raceeth != "4.Other") %>%
  mutate(raceeth = recode(raceeth, 
                          `1.White, Non-Hisp` = "White, non-Hispanic",
                          `2.Black, Non-Hisp` = "Black, non-Hispanic",
                          `3.Hispanic` = "Hispanic"
                          )) %>%  
  mutate(doby = rename_cohort(doby)) %>%  
  ggplot(aes(doby, ncharts_aftertax_income_P50, fill = raceeth)) +
  geom_col(position = "dodge") +
  scale_y_continuous(expand = expand_scale(mult = c(0, 0.15)), 
                     labels = scales::dollar) +
  labs(x = "Birth Cohort",
       y = NULL) +
  remove_ticks()

# create the output plot
plotr(titler("Although Retirement Incomes Are Projected to Rise for People of Color, They\nWill Continue to Lag Far Behind Incomes for Non-Hispanic Whites"),
      subtitler("Median annual per capita after-tax family income at age 70 (thousands of constant 2018 dollars)"),
      chart6,
      caption,
      sourcer("DYNASIM4, ID963"),
      heights = c(2.8, 1, 30, 1, 1))
```

## Chart 7: Social Security Is a Pillar of Retirement Security

* Quintiles are based on per-capita, price-adjusted, shared annuitized income with federal taxes, state taxes, payroll taxes and the Medicare surtax at age 70.
* Values are the mean of the different sources of income in each quintile. 

Financial income = per-capita interest + per-capita dividends + per-capita rental income + per-capita IRA withdrawals

Other income = pcNotModel_Mean

```{r chart7}
incomes <- c("Other income", "Financial income", "DB pension income", "Earnings", "Social Security")

quintile <- c("Bottom quintile", "Second quintile", "Third quintile", "Fourth quintile", "Top quintile")

chart7 <- read_csv("data/figure7.csv") %>%
  mutate(nchartQuin = paste(to_ordinal(nchartQuin), "quintile")) %>%
  mutate(nchartQuin = factor(nchartQuin, levels = quintile)) %>%
  filter(doby %in% cohorts) %>%
  mutate(`Financial income` = PCwlthinc_Mean + PCRetinc_Mean, 
         `Other income` = pcNotModel_Mean) %>%
  select(nchartQuin,
         doby,
         Earnings = PCearn_Mean, 
         `Social Security` = PCssb_Mean, 
         `DB pension income` = PCdbinc_Mean, 
         `Financial income`, `Other income`) %>%
  gather(key = "income_type", value = "income", Earnings, `Social Security`, `DB pension income`, `Financial income`, `Other income`) %>%
  mutate(income_type = factor(income_type, levels = incomes)) %>%
  ggplot(aes(doby, income, fill = income_type)) +
  geom_col(position = "fill") +
  scale_y_continuous(expand = expand_scale(mult = c(0, 0.1)), 
                     labels = scales::percent) +
  facet_wrap(~nchartQuin) +
  labs(x = "Birth Cohort",
       y = NULL) +
  remove_ticks() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))

# create the output plot
plotr(titler("Social Security Accounts for About 80 Percent of Income for Low-Income Retirees"),
      subtitler("Percent of age-70 per capita family income from Social Security by family income quintile"),
      chart7,
      caption,
      sourcer("DYNASIM4, ID963"),
      heights = c(1.8, 1, 30, 1, 1))
```





```{r chart7alt}
chart7alt <- read_csv("data/figure7.csv") %>%
  mutate(nchartQuin = paste(to_ordinal(nchartQuin), "quintile")) %>%
  mutate(nchartQuin = factor(nchartQuin, levels = quintile)) %>%
  mutate(ss_share = PCssb_Mean / ncharts_aftertax_income_Mean) %>%
  filter(doby %in% cohorts) %>%
  select(nchartQuin, doby, ss_share) %>%
  ggplot(aes(doby, ss_share, fill = nchartQuin)) +
  geom_col(position = "dodge") +
  geom_text(aes(label = scales::percent_format(accuracy = 1)(ss_share)),
            position = position_dodge(width = 0.7),
            vjust = -0.8,
            hjust = 0.35) +
  scale_y_continuous(expand = expand_scale(mult = c(0, 0.1)), 
                     labels = scales::percent) +
  labs(x = "Birth Cohort",
       y = NULL) +
  remove_ticks() +
  remove_axis()

# create the output plot
plotr(titler("Social Security Accounts for About 80 Percent of Income for Low-Income Retirees"),
      subtitler("Percent of age-70 per capita family income from Social Security by family income quintile"),
      chart7alt,
      caption,
      sourcer("DYNASIM4, ID963"),
      heights = c(1.8, 1, 30, 1, 1))
```


## Chart 9: The share of retirees who will likely experience a decline in living standards will grow slowly over time

```{r, chart9}

scheduled <- read_csv("data/figure1.csv") %>%
  mutate(law = "Current Social Security benefits continue")

payable <- read_csv("data/figure9.csv") %>%
  mutate(law = "Benefits cut 25%") %>%
  rename(ncharts_reprate = ncharts_reprate_payable)

chart9 <- bind_rows(scheduled, payable) %>%
  filter(ncharts_reprate %in% c("0-50%", "50-75%")) %>%
  filter(doby %in% cohorts) %>%
  group_by(doby, law) %>%
  summarize(rep_rate_threshold = sum(count_PctSum_10_count)) %>%
  ungroup() %>%
  mutate(law = factor(law, levels = c("Current Social Security benefits continue", "Benefits cut 25%"))) %>%
  mutate(doby = rename_cohort(doby)) %>%  
  ggplot(aes(doby, rep_rate_threshold, fill = law)) +
  geom_col(position = "dodge") +
  geom_text(mapping = aes(label = scales::percent_format(accuracy = 1)(rep_rate_threshold / 100)), 
            vjust = -1,
            position = position_dodge(width = 0.8)) +    
  scale_y_continuous(expand = expand_scale(mult = c(0, 0.1))) +
  labs(x = "Birth Cohort",
       y = NULL) +
  remove_ticks() +
  remove_axis()

# create the output plot
plotr(titler("Retirement Incomes May Fall Short for about 4 in 10 Early Millennials if Policymakers\nIgnore Social Security’s Financing Gap"),
      subtitler("Percentage of adults unable to replace 75% of their preretirement earnings at age 70 "),
      chart9,
      caption,
      sourcer("DYNASIM4, ID963"),
      heights = c(2.8, 1, 30, 1, 1))
```

## Chart 12

```{r, chart12}
chart12 <- read_csv("data/figure12.csv") %>%
  filter(doby %in% cohorts) %>%
  rename(`Current Social Security benefits continue` = ncharts_pov_Mean, 
         `Benefits cut 25%` = ncharts_pov_payable_Mean) %>%
  mutate(doby = rename_cohort(doby)) %>% 
  gather(key = "law", value = "poverty", -doby, -Obs) %>%
  mutate(law = factor(law, levels = c("Current Social Security benefits continue", "Benefits cut 25%"))) %>%
  ggplot(aes(doby, poverty, fill = law)) +
  geom_col(position = "dodge") +
  geom_text(mapping = aes(label = scales::percent_format(accuracy = 0.1)(poverty)), 
            vjust = -1,
            position = position_dodge(width = 0.8)) +    
  scale_y_continuous(expand = expand_scale(mult = c(0, 0.1))) +
  labs(x = "Birth Cohort",
       y = NULL) +
  remove_ticks() +
  remove_axis()  

# create the output plot
plotr(titler("A 25 Percent Social Security Benefit Cut Could Leave About One in Eight Gen X and\nEarly Millennial Retirees in Poverty"),
      subtitler("Percentage of adults with incomes below the federal poverty level at age 70 "),
      chart12,
      caption,
      sourcer("DYNASIM4, ID963"),
      heights = c(2.6, 1, 30, 1, 1))
```

## Chart 10 (experimental): More wives are out-earning their husband's

```{r, chart10}
read_csv("data/figure10.csv") %>%
  filter(doby <= 1985) %>%
  mutate(doby = case_when(
    doby <= 1945 ~ "1936-1945",
    doby <= 1955 ~ "1946-1955",
    doby <= 1965 ~ "1956-1965",
    doby <= 1975 ~ "1966-1975",
    doby <= 1985 ~ "1976-1985")
  ) %>% 
  mutate(doby = rename_cohort(doby)) %>%   
  ggplot(aes(x = lifetime_earn, y = slifetime_earn)) +
  geom_point(alpha = 0.05) +
  geom_smooth(method = "lm", formula = y ~ x - 1) +
  scale_x_continuous(expand = c(0, 0.05), 
                     limits = c(0, 10000000),
                     breaks = c(0, 5000000, 10000000),
                     labels = scales::dollar) +
  scale_y_continuous(expand = c(0, 0.05), 
                     limits = c(0, 10000000),
                     breaks = c(0, 5000000, 10000000),
                     labels = scales::dollar) +
  facet_wrap(~doby) +
  labs(
    title = "Wife's lifetime earnings vs. husband's lifetime earnings",
    subtitle = "Amongst married couples",
    x = "Wife's lifetime earnings",
    y = "Husband's lifetime earnings"
  ) +
  scatter_grid()

```

## Chart 13 taxes

```{r, chart13}

chart13 <- read_csv("data/figure13.csv") %>%
  filter(doby %in% cohorts) %>%
  mutate(avg_annual_tax_rate = (-1 * ncharts_tax_Mean) / ncharts_income_Mean) %>%
  mutate(doby = rename_cohort(doby)) %>%    
  filter(is.na(nchartQuin)) %>%
  ggplot(aes(doby, avg_annual_tax_rate)) +
  geom_col() +
  geom_text(mapping = aes(label = scales::percent_format(accuracy = 1)(avg_annual_tax_rate)), 
            vjust = -1,
            position = position_dodge(width = 0.8)) +    
  scale_y_continuous(expand = expand_scale(mult = c(0, 0.1))) +
  labs(x = "Birth Cohort",
       y = NULL) +
  remove_ticks() +
  remove_axis()  

plotr(titler("Millennials Will Have Higher Tax Rates in Retirement than Boomers"),
      subtitler("Average annual tax rate at age 70 (percent)"),
      chart13,
      caption,
      sourcer("DYNASIM4, ID963"),
      heights = c(2.6, 1, 30, 1, 1))
```





<!-- ## Chart 11 -->

<!-- ```{r} -->
<!-- read_csv("data/figure11.csv") %>% -->
<!--   mutate(year = doby + 70, -->
<!--          insolvency_delta = (ncharts_income_payable - ncharts_income) / ncharts_income, -->
<!--          quintile = cut(lifetime_earn, 5)) %>% -->
<!--   ggplot(aes(lifetime_earn, ncharts_reprate)) + -->
<!--   geom_point(alpha = 0.01) -->

<!-- read_csv("data/figure11.csv") %>% -->
<!--   ggplot(aes(ncharts_income, ncharts_reprate)) + -->
<!--   geom_point(alpha = 0.01) + -->
<!--   scale_x_continuous(limits = c(0, 1000000)) + -->
<!--   scale_y_continuous(limits = c(0, 10)) -->


<!-- read_csv("data/figure11.csv") %>% -->
<!--   mutate(percentile = ntile(ncharts_income, n = 100)) %>% -->
<!--   ggplot(aes(percentile, ncharts_reprate)) + -->
<!--   geom_point(alpha = 0.01) + -->
<!--   scale_x_continuous(limits = c(0, 100)) + -->
<!--   scale_y_continuous(limits = c(0, 10)) -->
<!-- ``` -->

<!-- ## Chart 13 (experimental): Failure to replace 75% of income spans the lifetime income spectrum -->

<!-- ```{r} -->
<!-- figure11 <- read_csv("data/figure11.csv") -->

<!-- figure11 %>% -->
<!--   mutate(lifetime_earn_percentile = ntile(lifetime_earn, 100)) %>% -->
<!--   group_by(lifetime_earn_percentile) %>% -->
<!--   mutate(ncharts_reprate = ncharts_reprate < 0.75) %>% -->
<!--   summarize(ncharts_reprate = mean(ncharts_reprate)) %>% -->
<!--   ggplot(aes(lifetime_earn_percentile, ncharts_reprate)) + -->
<!--   geom_point() -->
<!-- ``` -->
